<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dashboard | Zeni Vault</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header>
    <div class="header-container">
      <img src="assets/logo.png" alt="Zeni Vault Logo" class="logo" />
      <h1>Zeni Vault Dashboard</h1>
    </div>
  </header>

  <main class="dashboard">
  <section class="bank-info">
    <h2>Banking Details</h2>
    <p><strong>Bank:</strong> TymeBank</p>
    <p><strong>Account Number:</strong> 5300 1355 373</p>
    <p><strong>Admin Contact:</strong> 083 423 8988</p>
    <p><em>ðŸ’¸ Withdrawal fee: 18% applies to all payouts.</em></p>
  </section>

  <section id="userInfo" class="user-info"></section>

  <section class="note">
    <p>Referral Reward: <strong>20%</strong> for every person you refer!</p>
    <p>Your referral link:</p>
    <div id="refLink" class="ref-link"></div>
  </section>

  <!-- ðŸª™ Withdrawal Section -->
  <section class="withdraw">
    <h2>Request a Withdrawal</h2>
    <form id="withdrawForm">
      <label for="withdrawPhone">Your Contact Number</label>
      <input type="text" id="withdrawPhone" required />

      <label for="withdrawAmount">Withdrawal Amount (R)</label>
      <input type="number" id="withdrawAmount" required min="50" />

      <button type="submit" class="btn">Submit Withdrawal Request</button>
    </form>
  </section>

  <div class="center">
    <a href="login.html" class="btn logout">Logout</a>
  </div>
</main>

<script>
  const user = JSON.parse(localStorage.getItem("zeniUser"));
  const container = document.getElementById("userInfo");
  const refLink = document.getElementById("refLink");
  const phoneField = document.getElementById("withdrawPhone");

  if (!user) {
    container.innerHTML = "<p>Please log in first.</p>";
  } else {
    const start = new Date(user.startDate);
    const today = new Date();
    const diffDays = Math.floor((today - start) / (1000 * 60 * 60 * 24));
    const totalEarned = diffDays * parseFloat(user.dailyROI || 0);
    const daysLeft = 45 - diffDays;

    container.innerHTML = `
      <h2>Welcome, ${user.name}</h2>
      <div class="card">
        <p><strong>Phone:</strong> ${user.phone}</p>
        <p><strong>Package:</strong> ${user.package}</p>
        <p><strong>Invested:</strong> R${user.invested}</p>
        <p><strong>Daily ROI:</strong> R${user.dailyROI}</p>
        <p><strong>Days Active:</strong> ${diffDays} / 45</p>
        <p><strong>Days Remaining:</strong> ${daysLeft > 0 ? daysLeft : 0}</p>
        <p><strong>Total Earned:</strong> R${totalEarned}</p>
      </div>
    `;

    refLink.innerHTML = `https://zenivault.netlify.app/register?ref=${user.phone}`;
    phoneField.value = user.phone; // auto-fill contact
  }

  // WhatsApp redirect for withdrawals
  document.getElementById("withdrawForm").addEventListener("submit", (e) => {
    e.preventDefault();
    const phone = document.getElementById("withdrawPhone").value.trim();
    const amount = document.getElementById("withdrawAmount").value.trim();
    const message = encodeURIComponent(
      `Hello Zeni Vault, Iâ€™d like to withdraw R${amount}. My contact: ${phone}.`
    );
    window.open(`https://wa.me/27834238988?text=${message}`, "_blank");
  });
</script>
